"use strict";(self.webpackChunkweb_client_video_gateway=self.webpackChunkweb_client_video_gateway||[]).push([[721],{6721:function(e,t,a){a.r(t),a.d(t,{default:function(){return r}});var i=a(4526),o=(t={props:{parentObj:{type:Object,default(){return{Refresh:!1,parentId:""}}}},data(){return{imgSrc:a(7444),listLoading:!1,diglogFlag:!1,filtersForm:{name:null,tel:null,a:null,b:null,c:null,d:null,e:null,total:100,currentIndex:1,page:0,page_size:10},formObj:{},columns:[{prop:"name",label:"名称"},{prop:"code",label:"国标编码"},{prop:"manufacture",label:"厂家"},{prop:"reg_time",label:"注册时间"},{prop:"heartbeat_time",label:"心跳时间"},{prop:"is_online",label:"状态"}],tableData:[]}},watch:{parentObj:{deep:!0,handler(e){e={parent_id:e.parentId},this.getList(e)}}},mounted(){this.getList()},methods:{getList(e){this.tableData=[],this.listLoading=!0,(0,i.Y0)(e).then((e=>{this.tableData=e.data,this.listLoading=!1})).catch((e=>{this.listLoading=!1}))},handleCheck(e){this.diglogFlag=!0,this.formObj=e},handleEdit(e){this.$emit("editDialog",e,!0)},handleDelete(e){this.$confirm(`确定删除${e.name}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$emit("editDialog",e,!1)})).catch((()=>{}))}}},a(3736)),s=(t=(0,o.Z)(t,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-container"},[a("div",{staticClass:"search-item"},[a("el-button",{attrs:{size:"medium ",type:"primary"},on:{click:e.getList}},[e._v("刷新列表")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"table-item",attrs:{data:e.tableData,width:"100%",height:"string","header-cell-style":{"text-align":"center",color:"#3E4350",background:"#fafafa"},"cell-style":{"text-align":"center"}}},[a("el-table-column",{attrs:{label:"序号",align:"center",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.filtersForm.page*e.filtersForm.page_size+t.$index+1))]}}])}),e._l(e.columns,(function(t,i){return[a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.label},scopedSlots:e._u([{key:"default",fn:function(i){return[["reg_time","heartbeat_time"].includes(t.prop)?a("div",[e._v(e._s(e._f("timestampToTime")(i.row[t.prop])))]):["is_online"].includes(t.prop)?a("div",[i.row[t.prop]?a("span",{staticStyle:{color:"#67c23a"}},[e._v("在线")]):a("span",{staticStyle:{color:"#909399"}},[e._v("离线")])]):a("div",[e._v(e._s(i.row[t.prop]))])]}}],null,!0)})]})),a("el-table-column",{attrs:{label:"操作",align:"center",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"g-text-btn",on:{click:function(a){return e.handleEdit(t.row)}}},[a("i",{staticClass:"el-icon-edit svg-icon"}),e._v(" 修改 ")]),a("span",{staticClass:"g-text-btn g-del-btn",on:{click:function(a){return e.handleDelete(t.row)}}},[a("i",{staticClass:"el-icon-delete"}),e._v(" 删除 ")]),a("span",{staticClass:"g-text-btn",on:{click:function(a){return e.handleCheck(t.row)}}},[a("i",{staticClass:"iconfont svg-icon"},[e._v("")]),e._v(" 设备详情 ")])]}}])})],2),a("el-dialog",{staticClass:"g-small-dialog",attrs:{visible:e.diglogFlag,width:"35%"},on:{"update:visible":function(t){e.diglogFlag=t}}},[a("div",{staticClass:"el-dialog-title",attrs:{slot:"title"},slot:"title"},[e._v("设备详情")]),a("div",{staticClass:"dialog-content-item"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("span",[e._v("名称：")]),e._v(" "+e._s(e.formObj.name)+" ")]),a("el-col",{attrs:{span:12}},[a("span",[e._v("国标编码：")]),e._v(" "+e._s(e.formObj.code)+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("span",[e._v("SIP IP：")]),e._v(" "+e._s(e.formObj.ip)+" ")]),a("el-col",{attrs:{span:12}},[a("span",[e._v("SIP 端口：")]),e._v(" "+e._s(e.formObj.port)+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("span",[e._v("强制验证源地址：")]),e._v(" "+e._s(e.formObj.limit_ipport?"是":"否")+" ")]),a("el-col",{attrs:{span:12}},[a("span",[e._v("取流模式：")]),e._v(" "+e._s(e.formObj.rtp_mode?"TCP":"UDP")+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("span",[e._v("厂家：")]),e._v(" "+e._s(e.formObj.manufacture)+" ")]),a("el-col",{attrs:{span:12}},[a("span",[e._v("设备型号：")]),e._v(" "+e._s(e.formObj.model)+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("span",[e._v("状态：")]),e.formObj.is_online?a("span",{staticStyle:{color:"#67c23a","font-weight":"400"}},[e._v("在线")]):a("span",{staticStyle:{color:"#909399","font-weight":"400"}},[e._v("离线")])]),a("el-col",{attrs:{span:12}},[a("span",[e._v("注册时间：")]),e._v(" "+e._s(e._f("timestampToTime")(e.formObj.reg_time))+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("span",[e._v("心跳时间：")]),e._v(" "+e._s(e._f("timestampToTime")(e.formObj.heartbeat_time))+" ")])],1)],1)])],1)}),[],!1,null,"75047f7c",null).exports,a(1703),a(898)),l=(0,o.Z)({name:"EditDirectory",computed:{},props:["platformId"],created(){},data(){return{submitCallback:null,showDialog:!1,isLoging:!1,isEdit:!1,nameText:"",choose:"first",optionsArea:[{label:"UDP",value:0},{label:"TCP",value:1}],sipInfo:{},form:{name:void 0,code:void 0,parent_id:void 0,ip:void 0,port:void 0,limit_ipport:void 0,rtp_mode:0},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],code:[{required:!0,validator:(e,t,a)=>{t?(0,s.oo)(t)?a():a(new Error("请输入20位数字")):a(new Error("请输入国标编码"))}}],ip:[{required:!0,validator:(e,t,a)=>{t&&(0,s.v2)(t)?a():a(new Error("请输入SIP IP 如 127.0.0.1"))}}],port:[{required:!0,validator:(e,t,a)=>{t&&(0,s.Ru)(t)?a():a(new Error("请输入SIP端口 如：8080"))}}]}}},mounted(){this.getSipInfo()},methods:{openDialog(e,t,a,i,o,s){this.close(),this.isEdit=e,this.choose=t,this.form.parent_id=i,this.showDialog=!0,this.submitCallback=s,e?"second"===t?(this.nameText=a.data.name+"--\x3e编辑目录",this.form.name=a.data.name,this.form.parent_id=a.data.parent,this.form.code=a.data.id,this.form.old_code=a.data.id,this.form.is_dir=a.data.is_dir):"first"===t&&(o?(this.nameText=a.name+"--\x3e编辑下级网关平台",this.form=a,this.form.old_code=a.code):(this.nameText=a.data.name+"--\x3e编辑下级网关平台",this.getInfo(a.data.id))):"second"===t?this.nameText=a.data.name+"--\x3e新增子目录":"first"===t&&(this.nameText=a.data.name+"--\x3e新增下级网关平台")},getInfo(e){(0,i.Y_)({code:e}).then((e=>{this.form=e.data,this.form.old_code=e.data.code}))},getSipInfo(){(0,i.Km)().then((e=>{this.sipInfo=e.data}))},onSubmit(){let e=this;this.$refs.form.validate((t=>{if(!t)return!1;if(this.isEdit){let t={old_code:this.form.old_code,name:this.form.name,code:this.form.code};(0,i.bV)(t).then((a=>{a.status?(e.submitCallback&&e.submitCallback(t),e.$message.success("目录编辑成功！"),e.close(),e.showDialog=!1):this.$message({showClose:!0,message:a.data.msg,type:"error"})})).catch((e=>{}))}else{let t={parent_id:this.form.parent_id,name:this.form.name,code:this.form.code};(0,i.Su)(t).then((a=>{a.status?(e.submitCallback&&e.submitCallback(t),e.$message.success("目录添加成功！"),this.close(),e.showDialog=!1):e.$message({showClose:!0,message:a.message,type:"error"})})).catch((e=>{}))}}))},onSubmitGateway(){let e=this;e.$refs.form.validate((t=>{if(!t)return!1;if(e.isEdit){let t={old_code:e.form.old_code,name:e.form.name,ip:e.form.ip,port:e.form.port,limit_ipport:e.form.limit_ipport,rtp_mode:e.form.rtp_mode,code:e.form.code};(0,i.Ei)(t).then((a=>{a.status?(e.submitCallback&&e.submitCallback(t),e.$message.success("设备编辑成功！"),e.showDialog=!1,e.close()):e.$message({showClose:!0,message:a.data.msg,type:"error"})})).catch((e=>{}))}else{let t={dir_code_id:e.form.parent_id,name:e.form.name,ip:e.form.ip,port:e.form.port,limit_ipport:e.form.limit_ipport,rtp_mode:e.form.rtp_mode,code:e.form.code};(0,i._s)(t).then((a=>{a.status?(e.submitCallback&&e.submitCallback(t),e.$message.success("设备添加成功！"),e.close(),e.showDialog=!1):e.$message({showClose:!0,message:a.message,type:"error"})})).catch((e=>{}))}}))},close(){this.form={name:void 0,code:void 0,parent_id:void 0,ip:void 0,port:void 0,limit_ipport:void 0,rtp_mode:0},this.$refs?.form?.clearValidate()}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoging,expression:"isLoging"}],attrs:{id:"catalogEdit"}},[a("el-dialog",{attrs:{width:"30%","append-to-body":!0,visible:e.showDialog,"destroy-on-close":!0},on:{"update:visible":function(t){e.showDialog=t},closed:e.close}},[a("div",{staticClass:"el-dialog-title",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.nameText))]),a("div",{staticClass:"font-top"},["second"===e.choose?a("span",[e._v("注意：子目录名不能和现有目录重名。国标编码不能和现有设备、现有目录重复。")]):a("span",[e._v("SIP信令交互方式为：UDP模式 注册间隔：86400 心跳间隔：60秒(局域网设备)/20秒(公网设备) SIP-ID:"+e._s(e.sipInfo.sip_id)+" SIP-IP:"+e._s(e.sipInfo.sip_ip)+" SIP-PORT:"+e._s(e.sipInfo.sip_port))])]),a("div",[a("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"first"===e.choose?"设备名:":"目录名:",prop:"name"}},[a("el-input",{attrs:{clearable:"","show-word-limit":"",maxlength:"20"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"国标编码:",prop:"code"}},[a("el-input",{attrs:{clearable:"","show-word-limit":"",maxlength:"20"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),"first"===e.choose?a("div",[a("el-form-item",{attrs:{label:"SIP IP:",prop:"ip"}},[a("el-input",{attrs:{clearable:"","show-word-limit":"",maxlength:"16"},model:{value:e.form.ip,callback:function(t){e.$set(e.form,"ip",t)},expression:"form.ip"}})],1),a("el-form-item",{attrs:{label:"SIP端口:",prop:"port"}},[a("el-input",{attrs:{clearable:"","show-word-limit":"",maxlength:"6"},model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",t)},expression:"form.port"}})],1),a("el-form-item",{attrs:{label:"强制验证源地址: ",prop:"limit_ipport"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.limit_ipport,callback:function(t){e.$set(e.form,"limit_ipport",t)},expression:"form.limit_ipport"}}),e._v(" 开启后，当其SIP信令源地址符合上面的设置服务器才会返回响应 ")],1),a("el-form-item",{attrs:{label:"取流模式:",prop:"rtp_mode"}},[a("el-select",{attrs:{clearable:!1,placeholder:"请选择事件类型"},model:{value:e.form.rtp_mode,callback:function(t){e.$set(e.form,"rtp_mode",t)},expression:"form.rtp_mode"}},e._l(e.optionsArea,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e()],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取消")]),"first"===e.choose?a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmitGateway}},[e._v("确认")]):a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确认")])],1)])],1)}),[],!1,null,"59ae0ea1",null).exports,r=(0,o.Z)({components:{PlatformPage:t,EditDirectory:l},data(){return{dataTree:[],listLoading:!1,parentObj:{Refresh:!1,parentId:""},defaultProps:{children:"children",label:"name"},choiceId:"",activeIndex:"PersonList"}},mounted(){this.getList()},methods:{getList(){this.dataTree=[],this.listLoading=!0,(0,i.nS)().then((e=>{this.dataTree=this.jsonToTree(e.data),this.listLoading=!1})).catch((e=>{this.listLoading=!1}))},jsonToTree(e){let t=[];if(!Array.isArray(e))return t;let a={};return e.forEach((e=>{a[e.id]=e})),e.forEach((e=>{let i=a[e.parent];(i?i.children||(i.children=[]):t).push(e)})),t},handleNodeClick(e,t){this.parentObj.parentId=e.id},contextmenuEventHandler(e,t,a,i){return t.is_dir?this.$contextmenu({items:[{label:"添加设备",icon:"el-icon-s-operation",disabled:!1,onClick:()=>{this.addEquipment(t.id,a)}},{label:"添加目录",icon:"el-icon-plus",disabled:!1,onClick:()=>{this.addCatalog(t.id,a)}},{label:"编辑",icon:"el-icon-edit",disabled:1===a.level,onClick:()=>{this.editCatalog(t,a)}},{label:"删除",icon:"el-icon-delete",disabled:1===a.level,onClick:()=>{this.$confirm(`确定删除${a.label}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.removeCatalog(t.id,a)})).catch((()=>{}))}}],event:e,customClass:"custom-class",zIndex:3e3}):this.$contextmenu({items:[{label:"编辑",icon:"el-icon-edit",disabled:1===a.level,onClick:()=>{this.editCatalog(t,a)}},{label:"删除",icon:"el-icon-delete",disabled:1===a.level,divided:!1,onClick:()=>{this.$confirm(`确定删除${a.label}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.removeCatalog(t,a)})).catch((()=>{}))}}],event:e,customClass:"custom-class",zIndex:3e3}),!1},addEquipment(e,t){let a=this;a.$refs.catalogEdit.openDialog(!1,"first",t,e,!1,(e=>{a.parentObj.Refresh=!a.parentObj.Refresh,e={parent:e.dir_code_id,name:e.name,id:e.code,is_dir:!1},a.refreshCatalog(e)}))},addCatalog(e,t){let a=this;a.$refs.catalogEdit.openDialog(!1,"second",t,e,!1,(e=>{e={parent:e.parent_id,name:e.name,id:e.code,is_dir:!0},a.refreshCatalog(e)}))},editDialog(e,t){let a=this;t?a.$refs.catalogEdit.openDialog(!0,"first",e,e.dir_code_id,!0,(t=>{a.parentObj.Refresh=!a.parentObj.Refresh;t={parent:e.dir_code_id,name:t.name,id:t.code,is_dir:!1};var i=a.$refs.treeRef.getNode(e.code).data;Object.assign(i,t)})):(0,i.bD)({code:e.code}).then((t=>{t.status&&(this.$refs.treeRef.remove(e.code),this.parentObj.Refresh=!this.parentObj.Refresh)})).catch((function(e){}))},editCatalog(e,t){let a=this;e.is_dir?a.$refs.catalogEdit.openDialog(!0,"second",t,e.parent,!1,(i=>{a.parentObj.Refresh=!a.parentObj.Refresh,i={parent:e.parent,name:i.name,id:i.code,is_dir:!0},Object.assign(e,i),t.parent.loaded=!1,t.parent.expand()})):a.$refs.catalogEdit.openDialog(!0,"first",t,e.parent,!1,(t=>{a.parentObj.Refresh=!a.parentObj.Refresh,t={parent:e.parent,name:t.name,id:t.code,is_dir:!1},Object.assign(e,t)}))},removeCatalog(e,t){let a="";(a=t.data.is_dir?i.P$:i.bD)({code:e}).then((t=>{t.status&&(this.$refs.treeRef.remove(e),this.parentObj.Refresh=!this.parentObj.Refresh)})).catch((function(e){}))},refreshCatalog(e){this.$refs.treeRef.append(e,e.parent)},residentiaClick(e,t){this.residentiaIndexs=t}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"fact-page"},[a("div",{staticClass:"left-page"},[e._m(0),a("div",{staticClass:"resident-content"},[a("el-tree",{ref:"treeRef",staticClass:"tree-item",attrs:{data:e.dataTree,"node-key":"id",props:e.defaultProps,"expand-on-click-node":!1,"highlight-current":"","default-expand-all":""},on:{"node-click":e.handleNodeClick,"node-contextmenu":e.contextmenuEventHandler},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node;t=t.data;return[a("div",{staticClass:"tree-label"},[a("span",{staticClass:"tree-list"},[t.is_dir?a("i",{staticClass:"el-icon-folder svg-color"}):a("i",{staticClass:"el-icon-s-operation svg-color"}),e._v(" "+e._s(i.label)+" ")])])]}}])})],1)]),a("div",{staticClass:"right-page"},[a("PlatformPage",{attrs:{parentObj:e.parentObj},on:{editDialog:e.editDialog}})],1),a("EditDirectory",{ref:"catalogEdit"})],1)}),[function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{staticClass:"left-head"},[t("i",{staticClass:"iconfont"},[e._v("")]),e._v(" 下级平台 ")])}],!1,null,"1b7214b9",null).exports},7444:function(e,t,a){e.exports=a.p+"static/img/page-bg.e7136e09.png"}}]);